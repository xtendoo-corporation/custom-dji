<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="dji_administration.invoice_form_ihnerit_margin" model="ir.ui.view">
            <field name="name">account.invoice.form.inherit.margin</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account_invoice_margin.invoice_margin_form_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='margin'][1]" position="attributes">
                    <attribute name="groups">dji_administration.show_margins</attribute>
                </xpath><xpath expr="//field[@name='margin_percent'][1]" position="attributes">
                    <attribute name="groups">dji_administration.show_margins</attribute>
                </xpath>
            </field>
        </record>
        <record id="dji_administration.invoice_form_ihnerit" model="ir.ui.view">
            <field name="name">account.invoice.form.inherit</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="after">
                    <field name="is_admin" invisible="1"/>
                </xpath>

                <xpath expr="//field[@name='invoice_line_ids']//field[@name='price_unit']" position="replace">
                    <field name="can_edit_price" invisible="1"/>
                    <field name="price_unit" attrs="{'readonly': [('can_edit_price', '=', False)]}"/>
                </xpath>

                <xpath expr="//field[@name='invoice_line_ids']//field[@name='account_id']" position="replace">
                    <field name="can_edit_account" invisible="1"/>
                    <field name="account_id" attrs="{'readonly': [('can_edit_account', '=', False)]}"/>
                </xpath>

                <xpath expr="//field[@name='invoice_line_ids']//field[@name='quantity']" position="replace">
                    <field name="can_edit_quantity" invisible="1"/>
                    <field name="quantity" attrs="{'readonly': [('can_edit_quantity', '=', False)]}"/>
                </xpath>

                <xpath expr="//field[@name='invoice_line_ids']//field[@name='discount']" position="replace">
                    <field name="can_edit_discounts" invisible="1"/>
                    <field name="discount" attrs="{'readonly': [('can_edit_discounts', '=', False)]}"/>
                </xpath>

                <xpath expr="//field[@name='invoice_line_ids']//field[@name='product_id']" position="replace">
                    <field name="can_edit_product_id" invisible="1"/>
                    <field name="product_id" attrs="{'readonly': [('can_edit_product_id', '=', False)]}"/>
                </xpath>

                <xpath expr="//field[@name='invoice_line_ids']//field[@name='name']" position="replace">
                    <field name="can_edit_product_desc" invisible="1"/>
                    <field name="name" attrs="{'readonly': [('can_edit_product_desc', '=', False)]}"/>
                </xpath>

                <xpath expr="//field[@name='invoice_line_ids']//field[@name='asset_id']" position="replace">
                    <field name="can_edit_account" invisible="1"/>
                    <field name="asset_id" attrs="{'readonly': [('can_edit_account', '=', False)]}"/>
                </xpath>
                 <xpath expr="//field[@name='margin']" position="attributes">
                    <attribute name="groups">dji_administration.show_margins</attribute>
                </xpath>
                 <xpath expr="//page[@id='invoice_tab']/group" position="replace">
                     <group class="oe_subtotal_footer oe_right" attrs="{'invisible': ['|', ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')),                                                                ('payment_state' ,'=', 'invoicing_legacy')]}">
                         <field name="margin" groups="dji_administration.show_margins"/>
                         <field name="margin_percent" groups="dji_administration.show_margins"/>
                         <field name="amount_tax" invisible="1"/>
                         <field name="amount_untaxed" attrs="{'invisible': [('amount_tax', '=', 0)]}"/>
                         <field name="amount_by_group" widget="tax-group-custom-field" nolabel="1" colspan="2" attrs="{'invisible': [('amount_tax', '=', 0)]}"/>
                         <field name="commission_total" widget="monetary" options="{'currency_field': 'currency_id'}" attrs="{'invisible': [                         ('move_type', 'not in', ['out_invoice', 'out_refund'])                     ]}"/>
                         <field name="amount_total" attrs="{'invisible': [('amount_tax', '!=', 0)]}"/>
                         <field name="amount_total" class="oe_subtotal_footer_separator" attrs="{'invisible': [('amount_tax', '=', 0)]}"/>
                         <field name="invoice_payments_widget" colspan="2" nolabel="1" widget="payment"/>
                         <field name="amount_residual" class="oe_subtotal_footer_separator" attrs="{'invisible': [('state', '=', 'draft')]}"/>
                     </group>
                </xpath>
            </field>
        </record>

        <record id="dji_administration.invoice_form_cancel_inherit_dji" model="ir.ui.view">
            <field name="name">invoice.form.cancel.inherit.dji</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">

                <xpath expr="//button[@name='button_cancel']" position="attributes">
                    <attribute name="groups">dji_administration.cancel_invoice</attribute>
                </xpath>

                <xpath expr="//button[@name='action_reverse']" position="attributes">
                    <attribute name="groups">dji_administration.create_refund_invoice</attribute>
                </xpath>

            </field>
        </record>

        <record id="dji_administration.view_order_form_limit" model="ir.ui.view">
            <field name="name">view.order.form.limit</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='invoice_line_ids']/tree" position="attributes">
                    <attribute name="limit">800</attribute>
                </xpath>

                <xpath expr="//field[@name='line_ids']/tree" position="attributes">
                    <attribute name="limit">800</attribute>
                </xpath>

            </field>
        </record>

        <record id="dji_administration.view_order_form_sale_line_ids" model="ir.ui.view">
            <field name="name">view.order.form.sale.line.ids</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='invoice_line_ids']//field[@name='price_total']" position="after">
                    <field name="sale_line_ids" widget="many2many_tags"/>
                </xpath>

            </field>
        </record>

    </data>
</odoo>
